# å°è¯´æ”¹ç¼–åŠ©æ‰‹éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•éƒ¨ç½²å’Œé…ç½®å°è¯´æ”¹ç¼–åŠ©æ‰‹ç³»ç»Ÿã€‚

## å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶

1. å·²æœ‰è¿è¡Œçš„ HomePage é¡¹ç›®ï¼ˆå‚è€ƒä¸» README.mdï¼‰
2. Cloudflare è´¦æˆ·
3. Claude API Keyï¼ˆä» [Anthropic Console](https://console.anthropic.com/) è·å–ï¼‰

### éƒ¨ç½²æ­¥éª¤

#### 1. æ›´æ–° Worker ä»£ç 

å°†æ–°çš„ `worker.js` æ–‡ä»¶éƒ¨ç½²åˆ°æ‚¨çš„ Cloudflare Workerï¼š

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ **Workers å’Œ Pages**
3. é€‰æ‹©æ‚¨çš„ Worker
4. ç‚¹å‡» **ç¼–è¾‘ä»£ç **
5. å¤åˆ¶æ–°çš„ `worker.js` å†…å®¹
6. ç‚¹å‡» **ä¿å­˜å¹¶éƒ¨ç½²**

#### 2. é…ç½® Claude API Keyï¼ˆå¯é€‰ï¼‰

æœ‰ä¸¤ç§æ–¹å¼é…ç½® API Keyï¼š

**æ–¹å¼ 1ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰**

1. åœ¨ Worker è®¾ç½®ä¸­ï¼Œç‚¹å‡» **å˜é‡**
2. åœ¨ **ç¯å¢ƒå˜é‡** éƒ¨åˆ†ï¼Œç‚¹å‡» **æ·»åŠ å˜é‡**
3. æ·»åŠ å˜é‡ï¼š
   - **å˜é‡åï¼š** `CLAUDE_API_KEY`
   - **å€¼ï¼š** æ‚¨çš„ Claude API Key
4. ç‚¹å‡» **ä¿å­˜å¹¶éƒ¨ç½²**

**æ–¹å¼ 2ï¼šåº”ç”¨å†…è®¾ç½®ï¼ˆé€‚åˆä¸ªäººä½¿ç”¨ï¼‰**

1. è®¿é—® `https://your-domain/novel-adapter.html`
2. ç‚¹å‡»å·¦ä¾§ **è®¾ç½®**
3. è¾“å…¥æ‚¨çš„ API Key
4. ç‚¹å‡» **ä¿å­˜è®¾ç½®**

æ³¨æ„ï¼šæ–¹å¼2ä¼šå°† API Key å­˜å‚¨åœ¨ KV ä¸­ï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨æœ‰é€‚å½“çš„å®‰å…¨æªæ–½ã€‚

#### 3. éƒ¨ç½²å‰ç«¯æ–‡ä»¶

**å¦‚æœä½¿ç”¨ Cloudflare Pagesï¼š**

1. ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶åœ¨æ‚¨çš„ä»“åº“ä¸­ï¼š
   - `novel-adapter.html`
   - `static/novel-adapter.css`
   - `static/novel-adapter.js`

2. æ¨é€åˆ° GitHub

3. Cloudflare Pages ä¼šè‡ªåŠ¨éƒ¨ç½²

**å¦‚æœä½¿ç”¨å…¶ä»–æ‰˜ç®¡æ–¹å¼ï¼š**

å°†ä»¥ä¸‹æ–‡ä»¶ä¸Šä¼ åˆ°æ‚¨çš„ Web æœåŠ¡å™¨ï¼š
- `novel-adapter.html`
- `static/novel-adapter.css`
- `static/novel-adapter.js`

#### 4. æµ‹è¯•éƒ¨ç½²

1. è®¿é—® `https://your-domain/novel-adapter.html`
2. ç‚¹å‡» **æ–°å»ºé¡¹ç›®**
3. è¾“å…¥æµ‹è¯•å†…å®¹
4. ç‚¹å‡» **å¼€å§‹åˆ†æ**
5. ç¡®è®¤åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## é«˜çº§é…ç½®

### KV å­˜å‚¨é…ç½®

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹ KV é”®ï¼š

- `novel_projects` - æ‰€æœ‰é¡¹ç›®æ•°æ®
- `novel_adapter_settings` - ç”¨æˆ·è®¾ç½®ï¼ˆåŒ…æ‹¬ API Keyï¼‰

ç¡®ä¿ KV å‘½åç©ºé—´å·²æ­£ç¡®ç»‘å®šåˆ° Workerï¼ˆå˜é‡åï¼š`MY_HOME_KV`ï¼‰

### è‡ªå®šä¹‰ Claude æ¨¡å‹

é»˜è®¤ä½¿ç”¨ `claude-3-5-sonnet-20241022`ï¼Œå¯ä»¥åœ¨è®¾ç½®ä¸­é€‰æ‹©å…¶ä»–æ¨¡å‹ï¼š

- Claude 3.5 Sonnetï¼ˆæ¨èï¼‰- æœ€ä½³æ€§èƒ½å’Œè´¨é‡
- Claude 3 Opus - æœ€é«˜è´¨é‡ä½†è¾ƒæ…¢
- Claude 3 Haiku - æœ€å¿«ä½†è´¨é‡è¾ƒä½

### API é™åˆ¶é…ç½®

æ ¹æ®æ‚¨çš„ Claude API é…é¢ï¼Œå¯èƒ½éœ€è¦åœ¨åº”ç”¨ä¸­å®æ–½é€Ÿç‡é™åˆ¶ï¼š

```javascript
// åœ¨ worker.js ä¸­æ·»åŠ ç®€å•çš„é€Ÿç‡é™åˆ¶
const RATE_LIMIT = 10; // æ¯å°æ—¶æœ€å¤§è¯·æ±‚æ•°
const RATE_LIMIT_WINDOW = 3600000; // 1å°æ—¶ï¼ˆæ¯«ç§’ï¼‰
```

### CORS é…ç½®

å¦‚æœéœ€è¦ä»å…¶ä»–åŸŸåè®¿é—® APIï¼Œç¡®ä¿ Worker å“åº”ä¸­åŒ…å«æ­£ç¡®çš„ CORS å¤´ï¼š

```javascript
'Access-Control-Allow-Origin': '*'  // å·²åŒ…å«åœ¨ä»£ç ä¸­
```

## æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥

å¯¹äºå·²åˆ†æçš„é¡¹ç›®ï¼Œå¯ä»¥å®æ–½ç¼“å­˜ï¼š

```javascript
// åœ¨ KV ä¸­è®¾ç½®è¿‡æœŸæ—¶é—´
await kv.put(key, value, { expirationTtl: 86400 }); // 24å°æ—¶
```

### 2. å†…å®¹æˆªæ–­

ç³»ç»Ÿå·²è‡ªåŠ¨æˆªæ–­è¿‡é•¿çš„å†…å®¹ï¼š
- åˆ†æï¼šæœ€å¤š 20,000 å­—ç¬¦
- å‰§æœ¬ç”Ÿæˆï¼šæœ€å¤š 15,000 å­—ç¬¦
- è§’è‰²æ¡£æ¡ˆï¼šæœ€å¤š 10,000 å­—ç¬¦

### 3. å¼‚æ­¥å¤„ç†

å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œè€ƒè™‘ä½¿ç”¨ Cloudflare Durable Objects æˆ– Queueã€‚

## å®‰å…¨æœ€ä½³å®è·µ

### 1. API Key ä¿æŠ¤

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨ API Key
- âœ… ä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç¡¬ç¼–ç  API Key
- âœ… å®šæœŸè½®æ¢ API Key
- âŒ ä¸è¦å°† API Key æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

### 2. è®¤è¯å’Œæˆæƒ

ç›®å‰ç³»ç»Ÿæ²¡æœ‰å†…ç½®è®¤è¯ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ï¼š

1. å¤ç”¨ç°æœ‰çš„ HomePage è®¤è¯æœºåˆ¶
2. åœ¨ Worker ä¸­æ£€æŸ¥è®¤è¯çŠ¶æ€ï¼š

```javascript
// åœ¨ novel adapter è·¯ç”±å‰æ·»åŠ 
if (path.startsWith('/api/novel/') && !(await checkAuth(request, kv))) {
  return new Response(JSON.stringify({ error: 'Unauthorized' }), {
    status: 401,
    headers: { 'Content-Type': 'application/json' }
  });
}
```

### 3. è¾“å…¥éªŒè¯

ç³»ç»Ÿå·²åŒ…å«åŸºæœ¬çš„è¾“å…¥éªŒè¯ï¼Œä½†å¯ä»¥å¢å¼ºï¼š

- æ–‡ä»¶å¤§å°é™åˆ¶
- å†…å®¹æ ¼å¼éªŒè¯
- SQL/XSS æ³¨å…¥é˜²æŠ¤

### 4. é€Ÿç‡é™åˆ¶

å®æ–½ IP çº§åˆ«çš„é€Ÿç‡é™åˆ¶ä»¥é˜²æ­¢æ»¥ç”¨ï¼š

```javascript
// ä½¿ç”¨ KV è®°å½•è¯·æ±‚æ¬¡æ•°
const rateLimitKey = `rate_limit:${clientIP}`;
const requests = await kv.get(rateLimitKey) || 0;
if (requests > MAX_REQUESTS) {
  return new Response('Rate limit exceeded', { status: 429 });
}
```

## æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šWorker æŠ¥é”™ "KV namespace not bound"

**è§£å†³æ–¹æ³•ï¼š**
ç¡®ä¿åœ¨ Worker è®¾ç½®ä¸­ç»‘å®šäº† KV å‘½åç©ºé—´ï¼š
- å˜é‡åï¼š`MY_HOME_KV`
- KV å‘½åç©ºé—´ï¼šé€‰æ‹©æ‚¨åˆ›å»ºçš„å‘½åç©ºé—´

### é—®é¢˜ï¼šClaude API è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
1. API Key æ— æ•ˆæˆ–å·²è¿‡æœŸ
2. API é…é¢ç”¨å°½
3. ç½‘ç»œè¿æ¥é—®é¢˜
4. è¯·æ±‚æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
1. éªŒè¯ API Key æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ Anthropic æ§åˆ¶å°çš„ä½¿ç”¨æƒ…å†µ
3. æŸ¥çœ‹ Worker æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯
4. ç¡®è®¤è¯·æ±‚æ ¼å¼ç¬¦åˆ Claude API è§„èŒƒ

### é—®é¢˜ï¼šé¡¹ç›®æ•°æ®ä¸¢å¤±

**å¯èƒ½åŸå› ï¼š**
1. KV æ•°æ®è¢«æ¸…é™¤
2. è¶…è¿‡ KV å­˜å‚¨é™åˆ¶
3. JSON è§£æé”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
1. å®šæœŸå¯¼å‡ºé‡è¦é¡¹ç›®
2. ç›‘æ§ KV ä½¿ç”¨æƒ…å†µ
3. å®æ–½æ•°æ®å¤‡ä»½ç­–ç•¥

### é—®é¢˜ï¼šå‰ç«¯æ— æ³•è¿æ¥åç«¯

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] Worker æ˜¯å¦æ­£å¸¸è¿è¡Œ
- [ ] API ç«¯ç‚¹ URL æ˜¯å¦æ­£ç¡®
- [ ] CORS è®¾ç½®æ˜¯å¦æ­£ç¡®
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
- [ ] ç½‘ç»œè¯·æ±‚æ˜¯å¦æˆåŠŸ

## ç›‘æ§å’Œæ—¥å¿—

### æŸ¥çœ‹ Worker æ—¥å¿—

1. åœ¨ Cloudflare Dashboard ä¸­æ‰“å¼€ Worker
2. ç‚¹å‡» **æ—¥å¿—** æ ‡ç­¾
3. é€‰æ‹© **å®æ—¶æ—¥å¿—**

### æ·»åŠ è‡ªå®šä¹‰æ—¥å¿—

åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—ï¼š

```javascript
console.log('Novel analysis started:', projectId);
console.error('Claude API error:', error.message);
```

### ç›‘æ§æŒ‡æ ‡

å…³æ³¨ä»¥ä¸‹æŒ‡æ ‡ï¼š
- Worker è¯·æ±‚æ•°
- é”™è¯¯ç‡
- å¹³å‡å“åº”æ—¶é—´
- KV è¯»å†™æ¬¡æ•°
- Claude API è°ƒç”¨æ¬¡æ•°

## å‡çº§å’Œç»´æŠ¤

### æ›´æ–° Worker ä»£ç 

1. åœ¨æœ¬åœ°ä¿®æ”¹ `worker.js`
2. æµ‹è¯•æ›´æ”¹
3. éƒ¨ç½²åˆ° Cloudflare Worker
4. éªŒè¯åŠŸèƒ½æ­£å¸¸

### æ•°æ®è¿ç§»

å¦‚æœéœ€è¦è¿ç§»æ•°æ®ï¼š

1. å¯¼å‡ºç°æœ‰æ•°æ®ï¼š
```javascript
const projects = await kv.get('novel_projects', { type: 'json' });
console.log(JSON.stringify(projects, null, 2));
```

2. åœ¨æ–°ç¯å¢ƒå¯¼å…¥ï¼š
```javascript
await kv.put('novel_projects', JSON.stringify(projects));
```

### å¤‡ä»½ç­–ç•¥

å»ºè®®å®šæœŸå¤‡ä»½ï¼š
- æ¯å‘¨å¯¼å‡ºæ‰€æœ‰é¡¹ç›®æ•°æ®
- ä¿å­˜åœ¨å®‰å…¨çš„ä½ç½®
- æµ‹è¯•æ¢å¤æµç¨‹

## æˆæœ¬ä¼°ç®—

### Cloudflare å…è´¹é…é¢

- Workers: 100,000 è¯·æ±‚/å¤©
- KV: 100,000 è¯»å–/å¤©, 1,000 å†™å…¥/å¤©
- Pages: æ— é™è¯·æ±‚

### Claude API æˆæœ¬

æ ¹æ®ä½¿ç”¨çš„æ¨¡å‹ï¼š
- Claude 3.5 Sonnet: $3 / MTok è¾“å…¥, $15 / MTok è¾“å‡º
- Claude 3 Opus: $15 / MTok è¾“å…¥, $75 / MTok è¾“å‡º
- Claude 3 Haiku: $0.25 / MTok è¾“å…¥, $1.25 / MTok è¾“å‡º

ä¼°ç®—ï¼šä¸€æ¬¡å®Œæ•´çš„æ”¹ç¼–æµç¨‹ï¼ˆåˆ†æ+ç”Ÿæˆï¼‰çº¦æ¶ˆè€— 10,000 tokensã€‚

## æŠ€æœ¯æ”¯æŒ

å¦‚éœ€å¸®åŠ©ï¼š
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
2. æ£€æŸ¥ Worker å®æ—¶æ—¥å¿—
3. é˜…è¯» NOVEL_ADAPTER_README.md
4. æäº¤ Issue åˆ° GitHub ä»“åº“

## ç›¸å…³é“¾æ¥

- [Cloudflare Workers æ–‡æ¡£](https://developers.cloudflare.com/workers/)
- [Cloudflare KV æ–‡æ¡£](https://developers.cloudflare.com/workers/runtime-apis/kv/)
- [Claude API æ–‡æ¡£](https://docs.anthropic.com/claude/reference/getting-started-with-the-api)
- [Anthropic Console](https://console.anthropic.com/)

---

**ç¥æ‚¨éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€
